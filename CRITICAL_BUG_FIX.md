# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –ü–°–í —É–¥–∞–ª—è–ª–∏—Å—å –í–°–ï –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!**

### –ü—Ä–∏—á–∏–Ω–∞ –±–∞–≥–∞:

–ú–µ—Ç–æ–¥ `saveRecords()` –≤ `SupabaseService.ts` (—Å—Ç—Ä–æ–∫–∞ 166) **—É–¥–∞–ª—è–ª –í–°–ï –∑–∞–ø–∏—Å–∏** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö:

```javascript
// ‚ùå –û–ü–ê–°–ù–´–ô –ö–û–î (–±—ã–ª–æ):
async saveRecords(records: PEFRecord[]) {
  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  await supabase.from('pef_records').delete().eq('user_id', user.id);
  
  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
  await supabase.from('pef_records').insert(recordsWithUserId);
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ `AddEntryScreen.tsx` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏:

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±—ã–ª–æ):
const existingRecords = await Storage.getAllRecords();
await Storage.saveRecords([...existingRecords, newRecord]);
// ^ –≠—Ç–æ —É–¥–∞–ª—è–ª–æ –í–°–ï –∑–∞–ø–∏—Å–∏ –∏ –≤—Å—Ç–∞–≤–ª—è–ª–æ –∑–∞–Ω–æ–≤–æ!
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ `saveRecord()` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏:

```javascript
// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–´–ô –ö–û–î:
async saveRecord(record: PEFRecord) {
  // –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
  await supabase.from('pef_records').insert([recordWithUserId]);
}
```

### 2. –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `updateRecord()` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```javascript
async updateRecord(record: PEFRecord) {
  await supabase
    .from('pef_records')
    .update({...})
    .eq('id', record.id)
    .eq('user_id', user.id);
}
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `AddEntryScreen.tsx`:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Å—Ç–∞–ª–æ):
await Storage.saveRecord(newRecord);
// –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å!
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω `HistoryScreen.tsx`:

```javascript
// ‚úÖ –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
await Storage.updateRecord(updatedRecord);

// ‚úÖ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:
await Storage.deleteRecord(selectedRecord.id);
```

### 5. –ú–µ—Ç–æ–¥ `saveRecords()` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –æ–ø–∞—Å–Ω—ã–π:

```javascript
/**
 * ‚ö†Ô∏è –û–ü–ê–°–ù–û! –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –í–°–ï –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ saveRecord() –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏!
 */
async saveRecords(records: PEFRecord[]) {
  console.warn('‚ö†Ô∏è REPLACING ALL USER RECORDS');
  // ...
}
```

---

## üìä –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase:**
   - https://supabase.com ‚Üí Table Editor ‚Üí `pef_records`
   - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ

2. **Point-in-Time Recovery (–µ—Å–ª–∏ –µ—Å—Ç—å Pro –ø–ª–∞–Ω):**
   - Database ‚Üí Backups
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–æ –º–æ–º–µ–Ω—Ç–∞ –¥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

3. **–ï—Å–ª–∏ –±—ç–∫–∞–ø–æ–≤ –Ω–µ—Ç:**
   - –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –¥–∞–Ω–Ω—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ
   - –≠—Ç–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –Ω–∞ –±—É–¥—É—â–µ–µ

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:

1. ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:**
   - `saveRecord()` - –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω—É –∑–∞–ø–∏—Å—å (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
   - `updateRecord()` - –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
   - `deleteRecord()` - —É–¥–∞–ª–∏—Ç—å –æ–¥–Ω—É –∑–∞–ø–∏—Å—å (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
   - `saveRecords()` - –∑–∞–º–µ–Ω–∏—Ç—å –í–°–ï –∑–∞–ø–∏—Å–∏ (–æ–ø–∞—Å–Ω–æ, —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º)

2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
   - –í–∏–¥–Ω–æ, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è/—É–¥–∞–ª—è—é—Ç—Å—è

3. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –ú–µ—Ç–æ–¥—ã —á–µ—Ç–∫–æ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–ª–∏ –æ–ø–∞—Å–Ω—ã–µ
   - JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–í–∫–ª—é—á–∏—Ç–µ Point-in-Time Recovery –≤ Supabase:**
   - Settings ‚Üí Database ‚Üí Enable PITR
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.125/GB –≤ –º–µ—Å—è—Ü
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã:**
   - Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
   - –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä—É—á–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã

3. **–î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - Supabase ‚Üí Logs ‚Üí Database
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ DELETE –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—É—é dev –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ë–∞–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω.**

–¢–µ–ø–µ—Ä—å:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ **–Ω–µ —É–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ**
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ **–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ **—É–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É**
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ö–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. `src/services/SupabaseService.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã saveRecord(), updateRecord(), —É–ª—É—á—à–µ–Ω deleteRecord()
2. `src/services/Storage.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤
3. `src/screens/AddEntryScreen.tsx` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç saveRecord() –≤–º–µ—Å—Ç–æ saveRecords()
4. `src/screens/HistoryScreen.tsx` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç updateRecord() –∏ deleteRecord()

---

## üôè –ò–∑–≤–∏–Ω–µ–Ω–∏—è

–ü—Ä–∏–Ω–æ—à—É –≥–ª—É–±–æ—á–∞–π—à–∏–µ –∏–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ —ç—Ç–æ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —ç—Ç–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ, –∏ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞. –ë–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ä—ã, –∏ —Ç–∞–∫–æ–µ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è.

